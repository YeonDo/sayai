<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sayai - Game Record</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background-color: #f4f4f4; }
        .gnb {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #333;
            padding: 15px 30px;
            color: white;
        }
        .gnb-left {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .gnb a {
            color: white;
            text-decoration: none;
            font-size: 16px;
            font-weight: bold;
        }
        .gnb a:hover {
            color: #ddd;
        }
        .gnb-right button {
            padding: 8px 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
        }
        .gnb-right button:hover {
            background-color: #0056b3;
        }

        .container {
            max-width: 1000px;
            margin: 30px auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Sub GNB */
        .sub-gnb {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
        }
        .sub-gnb a {
            padding: 10px 20px;
            text-decoration: none;
            color: #555;
            font-weight: bold;
            border-bottom: 3px solid transparent;
        }
        .sub-gnb a.active {
            color: #007bff;
            border-bottom: 3px solid #007bff;
        }
        .sub-gnb a:hover {
            color: #007bff;
        }

        /* Search Section */
        .search-section {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .search-box {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .search-box h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            color: #333;
        }
        .search-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .search-form input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .search-form button {
            padding: 8px 16px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .search-form button:hover {
            background-color: #218838;
        }

        /* Results Table */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
            color: #333;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .row-win { background-color: #d4edda !important; }
        .row-draw { background-color: #fff3cd !important; }
        .row-loss { background-color: #f8d7da !important; }
        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Main GNB -->
    <div class="gnb">
        <div class="gnb-left">
            <a href="/record">기록 조회</a>
            <a href="/fantasy">판타지 리그</a>
            <a href="/episodes/1">사야이 뷰어</a>
        </div>
        <div class="gnb-right">
            <button type="button">로그인</button>
        </div>
    </div>

    <div class="container">
        <!-- Sub GNB -->
        <div class="sub-gnb">
            <a href="/record/game" class="active">경기 조회</a>
            <a href="/record/player">선수 조회</a>
        </div>

        <!-- Search Area -->
        <div class="search-section">
            <!-- Search by Date Range -->
            <div class="search-box">
                <h3>기간별 경기 조회</h3>
                <div class="search-form">
                    <input type="date" id="startDate">
                    <span>~</span>
                    <input type="date" id="endDate">
                    <button onclick="searchByDate()">조회</button>
                </div>
            </div>

            <!-- Search by Opponent -->
            <div class="search-box">
                <h3>상대편 이름으로 조회</h3>
                <div class="search-form">
                    <input type="text" id="opponentName" placeholder="상대팀명 입력">
                    <button onclick="searchByOpponent()">조회</button>
                </div>
            </div>
        </div>

        <!-- Result Area -->
        <div id="resultArea">
            <table id="resultTable">
                <thead>
                    <tr>
                        <th>경기 일시</th>
                        <th>구장</th>
                        <th>상대팀</th>
                        <th>결과</th>
                        <th>점수 (홈:원정)</th>
                        <th>게임원 링크</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Results will be injected here -->
                </tbody>
            </table>
            <div id="noResults" class="no-results">검색 결과가 없습니다.</div>
        </div>
    </div>

    <script>
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            return dateStr;
        }

        function formatTime(timeStr) {
            if (!timeStr) return '-';
            return timeStr; // Assuming HH:mm:ss or similar
        }

        async function searchByDate() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            if (!startDate || !endDate) {
                alert('시작일과 종료일을 모두 선택해주세요.');
                return;
            }

            try {
                const response = await fetch(`/apis/v1/game/list?start=${startDate}&end=${endDate}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                renderResults(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('데이터를 불러오는 중 오류가 발생했습니다.');
            }
        }

        async function searchByOpponent() {
            const opponent = document.getElementById('opponentName').value.trim();

            if (!opponent) {
                alert('상대팀 이름을 입력해주세요.');
                return;
            }

            try {
                const response = await fetch(`/apis/v1/game/opponent/${encodeURIComponent(opponent)}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                renderResults(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('데이터를 불러오는 중 오류가 발생했습니다.');
            }
        }

        function renderResults(data) {
            const tbody = document.querySelector('#resultTable tbody');
            const noResults = document.getElementById('noResults');
            const table = document.getElementById('resultTable');

            tbody.innerHTML = '';

            if (!data || data.length === 0) {
                table.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }

            table.style.display = 'table';
            noResults.style.display = 'none';

            data.forEach(game => {
                const tr = document.createElement('tr');

                if (game.result === '승') {
                    tr.classList.add('row-win');
                } else if (game.result === '무') {
                    tr.classList.add('row-draw');
                } else if (game.result === '패') {
                    tr.classList.add('row-loss');
                }

                // Fields: Date + Time, Stadium, Opponent, Result, Score, Gameone Link
                tr.innerHTML = `
                    <td>${formatDate(game.gameDate)} ${formatTime(game.gameTime)}</td>
                    <td>${game.stadium || '-'}</td>
                    <td>${game.opponent}</td>
                    <td>${game.result || '-'}</td>
                    <td>${game.homeScore} : ${game.awayScore}</td>
                    <td><a href="${game.gameoneLink}" target="_blank">게임원 링크</a></td>
                `;
                tbody.appendChild(tr);
            });
        }
    </script>
</body>
</html>
